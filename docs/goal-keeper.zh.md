# 守门员

守门员在一块由蓝色胶带划定的长方形区域中行动，以长方形的一条边线作为底线，阻止途径长方形的塑料球到达底线。

本游戏有以下预设条件：

* 长方形内应当水平、平整并且没有障碍物。
* 球在发出后不应当离开地面。
* 球不应当在长方形内受到机甲以外的外部因素控制。

```
       Kick a Ball

            +
            |
            |
            |
            v

        Top Line
+------------------------+
|                        |
|                        |
|           X            |
|       Robomaster       |
|                        |
|                        |
+------------------------+
     Bottom Line(Goal)
```

# 生命周期

1. 启动和连接：连接到机甲；
1. 建立坐标系：建立以底线中点为原点，底线方向为x轴的二维平面坐标系；
1. 回中：机甲移动到长方形的几何中心，摄像头（云台）望向上边线方向（即长方形底边的对边，期望的球的来向）；
1. 警戒（可选）：寻找视野中的塑料球，标定其在坐标系中的位置，重复本动作，直到球到达或超过上边线；
1. 拦截：寻找视野中的塑料球，标定其在坐标系中的位置，估计球与x轴的交点和到达时间，求取合适初速度作为PID初值，PID控制直到球和机甲在x轴方向上的差异为0；
1. 回踢：将球踢向上边线方向；
1. 回中并重复。

## 启动和连接

1. 启动程序，监听机甲IP UDP广播，连接到机甲；
1. 使能SDK模式；
1. 使用`version`命令测量网络延时；
1. 开启视频流；
1. 连接视频流，确定视频流已正常推送；
1. 再次使用`version`命令测量网络延时；
1. 开启云台和底盘消息推送；
1. 修改装甲板灵敏度，开启装甲板事件上报。

## 建立坐标系

1. 云台`yaw`相对调整`-10°`，每次`60°`分6次环视四周；
1. 每次环视时，确认蓝色线条的角度、距离、开合方向，标定在上电时的坐标系上；
1. 环视时标记底线所在的角度，标定在上电时的坐标系上；
1. 去重，取四角的角度、距离，并且确定机甲在四边形内部（根据角的开合方向判断）；
1. 标定长方形和底线，求出上电坐标系到长方形坐标系的旋转方案。

## 警戒（可选）

1. 取视频帧，提取球在图中的位置，标定球的位置`(x, y)`；
1. 如果球的`y`不大于上边线开始拦截；

## 拦截（简单）

1. 追随球的x位置，沿底线方向左右运动；
1. 最小化机甲和球的x位置的差值；
1. 若机甲接近左右边线，停止机甲；